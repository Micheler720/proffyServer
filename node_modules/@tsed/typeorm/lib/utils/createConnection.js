"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.createConnection = void 0;
const typeorm_1 = require("typeorm");
const connections = new Map();
async function createConnection(connectionOptions) {
    const connectionManager = typeorm_1.getConnectionManager();
    const name = connectionOptions.name;
    if (!connections.has(name)) {
        const connection = connectionManager.create(connectionOptions);
        connections.set(name, connection.connect());
    }
    await connections.get(name);
    const connection = connectionManager.get(name);
    // Add hook to close connection when server is killed
    // @ts-ignore
    connection.$onDestroy = connection.$onDestroy || (() => connection.isConnected && connection.close());
    return connection;
}
exports.createConnection = createConnection;
//# sourceMappingURL=createConnection.js.map